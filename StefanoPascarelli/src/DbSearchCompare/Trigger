#!/usr/bin/python

import sys
import os
import time
from Bio import SeqIO

dbpath="~/PDATA/workspace/fastpfam_pipeline_v0.9/pfam/"


def main(args):
    if len(args)< 3:
     print "Usage: Trigger inputfile.fasta outfolder/"
     sys.exit()
    inFile = args[1]
    outDir = args[2] 
    if os.path.exists(outDir) is False:
        os.mkdir(outDir)


    with open(inFile, "rU") as seqFile:

        if os.path.exists(outDir+"/entry_collection/") is False:
         os.mkdir(outDir+"/entry_collection/")

        if os.path.exists(outDir+"/statistics/") is False:
         os.mkdir(outDir+"/statistics/")

        for entry in list(SeqIO.parse(seqFile, "fasta")):
            tmpDir = outDir + "/entry_collection/"+ entry.id + "/"

            if os.path.exists(tmpDir) is False:
                os.mkdir(tmpDir)

            with open(tmpDir + "query.fa", "w") as outFile:
                outFile.write(">" + str(entry.id) + "\n" + str(entry.seq))

            os.system("./fa2prfs_pfamscan.sh " + tmpDir+" "+dbpath);


#domain comparison
    print "Starting domain comparison..."
    os.system("python domtest.py "+outDir)
    print "Ending domain comparison"

#graph building
    print "Starting graph construction..."
    os.system("python scoredistr.py "+outDir)
    print "Ending graph construction"

#legend
    print "building legend.txt..."
    os.system("python legend.py "+outDir)

    print "Job finished!"
        
if __name__=="__main__":
    main(sys.argv)

